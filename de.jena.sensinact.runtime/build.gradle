/*
 * build Gradle build script
 */

configurations {
  bundles
}

task prepareDocker(dependsOn: build){
	def stageDir = file('generated/docker')
	def contentDir = new File(stageDir, "content")
	doFirst {
		stageDir.deleteDir()
    }
    doLast {
		println "Prepare for Docker build"
		contentDir.mkdirs()
	     // copy all necessary files to  build/docker/ dir
	    copy {
	        from {
	            zipTree("generated/distro.zip")
	        }
	        into contentDir
	    }
	    copy {
	        from 'docker'
	        into stageDir
	    }
    }
}

task buildDocker(type:Exec, dependsOn: prepareDocker){
	
	workingDir 'generated/docker'
    def tag = "jena/sensinact:latest"
	executable "docker"

	args "build", "-f", "Dockerfile", ".", "-t", tag
	
	doFirst{
		println "Building docker image jena/sensinact"
	}
}
